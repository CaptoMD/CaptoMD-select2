angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var a=[];return{$register:function(b){a.push(b)},$unregister:function(b){var c=a.indexOf(b);c!==-1&&a.splice(c,1)},closeAll:function(){a.forEach(function(a){a.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$animate","$q","select2Config","select2Stack",function(a,b,c,d,e,f,g){"use strict";function h(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}var i={},j=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return f&&angular.extend(i,f),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden">',replace:!0,link:function(a,f,k,l){function m(a){if(l.$isEmpty(a))return e.when(void 0);if(p){for(var b=[],c=0;c<a.length;c++){var d=v[a[c]];if(angular.isUndefined(d)){b=void 0;break}b.push(d)}return angular.isDefined(b)?e.when(b):u().then(function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=a||[];f.indexOf(e.id)>-1&&c.push(e)}return c})}var f=v[a];return f?e.when(f):u().then(function(b){for(var c=0;c<b.length;c++){var d=b[c];if(a===d.id)return d}})}function n(a){if(angular.isArray(a))for(var b=0;b<a.length;b++)n(a[b]);else a&&(v[a.id]=a)}var o=angular.extend({},i,a.$eval(k.options)),p=angular.isDefined(k.multiple)||o.multiple,q=angular.isDefined(k.hideSearchbox)&&"false"!==k.hideSearchbox;if(o.multiple=p,p){var r=l.$isEmpty;l.$isEmpty=function(a){return r(a)||0===a.length}}if(k.emptyValue){var s=l.$isEmpty;l.$isEmpty=function(a){return s(a)||a===k.emptyValue}}var t=k.placeholder||k.emptyValue;t?o.placeholder=t:k.allowClear&&(o.placeholder="-"),k.allowClear&&(o.allowClear=k.allowClear);var u,v={};if(k.s2Options){var w;if(!(w=k.s2Options.match(j)))throw new Error("Invalid s2Options encountered!");var x=c(w[2]||w[1]),y=c(w[7]),z=w[4]||w[6],A=c(w[2]?w[1]:z),B=w[5];u=function(){v={};for(var b=y(a),c=(B?h(b):b)||[],d=[],f=0;f<c.length;f++){var g={},i=f;B&&(i=c[f],g[B]=i),g[z]=b[i];var j=A(a,g),k=x(a,g)||"";v[j]={id:j,text:k,obj:b[i]},d.push(v[j])}e.when(d)},o.query=function(b){for(var c=y(a),d=(B?h(c):c)||[],e=[],f=0;f<d.length;f++){var g={},i=f;B&&(i=d[f],g[B]=i),g[z]=c[i];var j=A(a,g),k=x(a,g)||"";k.toLowerCase().indexOf(b.term.toLowerCase())>-1&&e.push({id:j,text:k,obj:c[i]})}b.callback({results:e})},a.$watchCollection(w[7],function(){l.$render()}),u()}else{if(!o.query)throw new Error("You need to supply a query function!");var C=o.query;o.query=function(a){var b=a.callback;a.callback=function(a){for(var c=0;c<a.results.length;c++){var d=a.results[c];v[d.id]=d}b(a)},C(a)},u=function(a){var b=e.defer();return o.query({term:"",callback:function(a){b.resolve(a.results)}}),b.promise}}if(o.initSelection){var D=o.initSelection;o.initSelection=function(a,b){return l.$isEmpty(l.$modelValue)?b():void D(l.$modelValue,function(a){n(a),b(a),l.$validate()})}}else o.initSelection=function(a,b){return l.$isEmpty(l.$modelValue)?b():void m(l.$modelValue).then(b).then(function(){l.$validate()})};var E={close:function(){f.select2("close")}};g.$register(E),a.$on("destroy",function(){g.$unregister(E)}),b(function(){f.val(l.$viewValue),f.select2(o),f.on("change",function(a){l.$setViewValue(a.val)}),f.on("select2-blur",function(){l.$touched||l.$setTouched()}),l.$render=function(){p?m(l.$viewValue).then(function(a){f.select2("data",a)}):f.select2("val")!==this.$viewValue&&f.select2("val",this.$viewValue)},l.$validators.value=function(a){if(l.$isEmpty(a))return!0;if(p){for(var b=0;b<a.length;b++){var c=v[a[b]];if(!c||c.invalid)return!1}return!0}return v[a]&&!v[a].invalid},t||d.addClass(f.select2("container"),"select2-placeholder-hidden"),q&&d.addClass(f.select2("dropdown"),"select2-searchbox-hidden")})}}}]);