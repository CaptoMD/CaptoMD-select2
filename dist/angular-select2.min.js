angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var e=[];return{$register:function(t){e.push(t)},$unregister:function(t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)},closeAll:function(){e.forEach(function(e){e.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$animate","$q","select2Config","select2Stack",function(e,t,n,r,i,l,o){"use strict";function a(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort()}var s={},u=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return l&&angular.extend(s,l),{restrict:"E",require:["ngModel","select2"],template:'<input type="hidden">',bindToController:{s2Query:"<",s2InitSelection:"<"},controller:["$element",function(e){this.open=function(){e.select2("open")},this.close=function(){e.select2("close")};var t=[];this.onReady=function(e){t.push(e)},this.$postLink=function(){for(var e=0;e<t.length;++e)t[e].apply(this)},Object.defineProperty(this,"value",{get:function(){return e.select2("val")},set:function(t){e.select2("val",t)}})}],link:function(e,t,l,c){function f(e){if(h.$isEmpty(e))return i.when(void 0);if(y){for(var t=[],n=0;n<e.length;n++){var r=E[e[n]];if(angular.isUndefined(r)){t=void 0;break}t.push(r)}return angular.isDefined(t)?i.when(t):C().then(function(t){for(var n=[],r=0;r<t.length;r++){var i=t[r];(e||[]).indexOf(i.id)>-1&&n.push(i)}return n})}var l=E[e];return l?i.when(l):C().then(function(t){for(var n=0;n<t.length;n++){var r=t[n];if(e===r.id)return r}})}function d(e){if(angular.isArray(e))for(var t=0;t<e.length;t++)d(e[t]);else e&&(E[e.id]=e)}var h=c[0],v=c[1],p=angular.extend({},s,e.$eval(l.options)),y=angular.isDefined(l.multiple)||p.multiple,m=angular.isDefined(l.hideSearchbox)&&"false"!==l.hideSearchbox;if(Object.defineProperty(v,"options",{value:p}),Object.defineProperty(v,"isMultiple",{value:y}),Object.defineProperty(v,"hideSearchBox",{value:m}),p.multiple=y,y){var g=h.$isEmpty;h.$isEmpty=function(e){return g(e)||0===e.length}}if(l.emptyValue){var w=h.$isEmpty;h.$isEmpty=function(e){return w(e)||e===l.emptyValue}}if(angular.isDefined(l.allowClear)&&(p.allowClear="false"!==l.allowClear),angular.isUndefined(p.placeholder)){var b=l.placeholder||l.emptyValue;b?p.placeholder=b:p.allowClear&&(p.placeholder="-")}var C,E={};if(l.s2Options){var S;if(!(S=l.s2Options.match(u)))throw new Error("Invalid s2Options encountered!");var V=n(S[2]||S[1]),x=n(S[7]),O=S[4]||S[6],k=n(S[2]?S[1]:O),q=S[5];C=function(){E={};for(var t=x(e),n=(q?a(t):t)||[],r=[],l=0;l<n.length;l++){var o={},s=l;q&&(s=n[l],o[q]=s),o[O]=t[s];var u=k(e,o),c=V(e,o)||"";E[u]={id:u,text:c,obj:t[s]},r.push(E[u])}return i.when(r)},p.query=function(t){for(var n=x(e),r=(q?a(n):n)||[],i=[],l=0;l<r.length;l++){var o={},s=l;q&&(s=r[l],o[q]=s),o[O]=n[s];var u=k(e,o),c=V(e,o)||"";c.toLowerCase().indexOf(t.term.toLowerCase())>-1&&i.push({id:u,text:c,obj:n[s]})}t.callback({results:i})},e.$watchCollection(S[7],function(){C().then(function(){h.$render()})})}else{if(!p.query&&!l.s2Query)throw new Error("You need to supply a query function!");var j=p.query;p.query=function(e){var t=e.callback;e.callback=function(e){for(var n=0;n<e.results.length;n++){var r=e.results[n];E[r.id]=r}t(e)},(j||v.s2Query)(e)},C=function(){var e=i.defer();return p.query({term:"",callback:function(t){e.resolve(t.results)}}),e.promise}}if(p.initSelection||l.s2InitSelection){var P=p.initSelection;p.initSelection=function(e,t){if(h.$isEmpty(h.$modelValue))return t();(P||v.s2InitSelection)(h.$modelValue,function(e){d(e),t(e),h.$validate()})}}else p.initSelection=function(e,t){if(h.$isEmpty(h.$modelValue))return t();f(h.$modelValue).then(t).then(function(){h.$validate()})};o.$register(v),e.$on("$destroy",function(){t.select2("destroy"),o.$unregister(v)}),t.select2(p),t.on("change",function(e){h.$setViewValue(e.val)}),t.on("select2-blur",function(){h.$touched||h.$setTouched()}),t.on("select2-open",function(){e.$emit("select2:open")}),t.on("select2-close",function(){e.$emit("select2:close")}),h.$render=function(){y?f(h.$viewValue).then(function(e){t.select2("data",e)}):v.value!==this.$viewValue&&(v.value=this.$viewValue)},h.$validators.value=function(e){if(h.$isEmpty(e))return!0;if(y){for(var t=0;t<e.length;t++){var n=E[e[t]];if(!n||n.invalid)return!1}return!0}return E[e]&&!E[e].invalid},y||l.$observe("placeholder",function(e){if(h.$isEmpty(h.modelValue)){var n=$(t.select2("container"));n.find(".select2-choice").addClass("select2-default"),n.find(".select2-chosen").html(e)}}),p.placeholder||r.addClass(t.select2("container"),"select2-placeholder-hidden"),m&&r.addClass(t.select2("dropdown"),"select2-searchbox-hidden")}}}]);