"use strict";require("Select2/select2"),require("Select2/select2.css"),require("select2-bootstrap-css/select2-bootstrap.css"),module.exports=angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var a=[];return{$register:function(b){a.push(b)},$unregister:function(b){var c=a.indexOf(b);c!==-1&&a.splice(c,1)},closeAll:function(){a.forEach(function(a){a.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$filter","select2Config","select2Stack",function(a,b,c,d,e,f){function g(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}var h=d("filter"),i={},j=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return e&&angular.extend(i,e),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden"></input>',replace:!0,link:function(a,d,e,k){function l(b){if(q){var c=q(a);if(c)return h(b,c)}return b}function m(a){n(p?function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=k.$viewValue||[];f.indexOf(e.id)>-1&&c.push(e)}a(c)}:function(){a(s[k.$viewValue]||{obj:{}})})}"undefined"!=typeof jQuery&&(d=jQuery(d));var n,o=angular.extend({},i,a.$eval(e.options)),p=angular.isDefined(e.multiple)||o.multiple;o.multiple=p,p&&(k.$isEmpty=function(a){return!a||0===a.length}),e.placeholder&&(o.placeholder=e.placeholder);var q=c(e.optionsFilter),r=c(e.queryFilter),s={};if(e.s2Options){var t;if(!(t=e.s2Options.match(j)))throw new Error("Invalid s2Options encountered!");var u=c(t[2]||t[1]),v=c(t[7]),w=t[4]||t[6],x=c(t[2]?t[1]:w),y=t[5];n=function(b){s={};for(var c=l(v(a)),d=(y?g(c):c)||[],e=[],f=0;f<d.length;f++){var h={},i=f;y&&(i=d[f],h[y]=i),h[w]=c[i];var j=x(a,h),k=u(a,h)||"";s[j]={id:j,text:k,obj:c[i]},e.push(s[j])}b(e)},o.query=function(b){var c,d=l(v(a));r&&(c=r(a,{term:b.term,values:d}),c&&(d=c));var e=(y?g(d):d)||[],f=[];s={};for(var h=0;h<e.length;h++){var i={},j=h;y&&(j=e[h],i[y]=j),i[w]=d[j];var k=x(a,i),m=u(a,i)||"";(c||m.toLowerCase().indexOf(b.term.toLowerCase())>-1)&&(s[k]={id:k,text:m,obj:d[j]},f.push(s[k]))}b.callback({results:f})},a.$watch(t[7],function(){k.$render()})}else{if(!o.query)throw new Error("You need to supply a query function!");var z=o.query;o.query=function(a){var b=a.callback;a.callback=function(a){for(var c=0;c<a.results.length;c++){var d=a.results[c];s[d.id]=d}b(a)},z(a)},n=function(a){o.query({term:"",callback:function(b){a(b.results)}})}}if(k.$render=function(){m(function(a){p?d.select2("data",a):d.select2("val",a.id)})},o.initSelection){var A=o.initSelection;o.initSelection=function(a,b){A(a,function(a){s[a.id]=a,b(a)})}}else o.initSelection=function(a,b){m(b)};var B={close:function(){d.select2("close")}};f.$register(B),a.$on("destroy",function(){f.$unregister(B)}),b(function(){d.select2(o),d.on("change",function(b){a.$evalAsync(function(){var c;if(p){for(var d=[],f=0;f<b.val.length;f++)c=s[b.val[f]],c&&d.push(c.id);k.$setViewValue(d),e.onChange&&a.$eval(e.onChange,{values:d})}else c=s[b.val],k.$setViewValue(c?c.id:null),e.onChange&&a.$eval(e.onChange,{value:c?c.id:null});k.$render()})}),d.on("select2-blur",function(){k.$touched||a.$evalAsync(k.$setTouched)}),k.$render()})}}}]).name;