angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var a=[];return{$register:function(b){a.push(b)},$unregister:function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},closeAll:function(){a.forEach(function(a){a.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$animate","select2Config","select2Stack",function(a,b,c,d,e,f){"use strict";function g(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}var h={},i=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return e&&angular.extend(h,e),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden">',replace:!0,link:function(a,e,j,k){function l(a){if(o)m(function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=k.$viewValue||[];f.indexOf(e.id)>-1&&c.push(e)}return a(c)});else{var b=s[k.$viewValue];if(b)return a(b);m(function(b){for(var c=0;c<b.length;c++){var d=b[c];if(k.$viewValue===d.id)return a(d)}return a()})}}var m,n=angular.extend({},h,a.$eval(j.options)),o=angular.isDefined(j.multiple)||n.multiple,p=angular.isDefined(j.hideSearchbox)&&"false"!==j.hideSearchbox;if(n.multiple=o,o&&(k.$isEmpty=function(a){return!a||0===a.length}),j.emptyValue){var q=k.$isEmpty;k.$isEmpty=function(a){return q(a)||a===j.emptyValue}}var r=j.placeholder||j.emptyValue;r&&(n.placeholder=r),j.allowClear&&(n.allowClear=j.allowClear);var s={};if(j.s2Options){var t;if(!(t=j.s2Options.match(i)))throw new Error("Invalid s2Options encountered!");var u=c(t[2]||t[1]),v=c(t[7]),w=t[4]||t[6],x=c(t[2]?t[1]:w),y=t[5];m=function(b){s={};for(var c=v(a),d=(y?g(c):c)||[],e=[],f=0;f<d.length;f++){var h={},i=f;y&&(i=d[f],h[y]=i),h[w]=c[i];var j=x(a,h),k=u(a,h)||"";s[j]={id:j,text:k,obj:c[i]},e.push(s[j])}b(e)},n.query=function(b){for(var c=v(a),d=(y?g(c):c)||[],e=[],f=0;f<d.length;f++){var h={},i=f;y&&(i=d[f],h[y]=i),h[w]=c[i];var j=x(a,h),k=u(a,h)||"";k.toLowerCase().indexOf(b.term.toLowerCase())>-1&&e.push({id:j,text:k,obj:c[i]})}b.callback({results:e})},a.$watchCollection(t[7],function(){k.$render()}),m(angular.noop)}else{if(!n.query)throw new Error("You need to supply a query function!");var z=n.query;n.query=function(a){var b=a.callback;a.callback=function(a){for(var c=0;c<a.results.length;c++){var d=a.results[c];s[d.id]=d}b(a)},z(a)},m=function(a){n.query({term:"",callback:function(b){a(b.results)}})}}var A=!1;if(k.$render=function(){A&&(k.$isEmpty(this.$viewValue)?(d.removeClass(e.select2("container"),"select2-container-not-empty"),o?e.select2("data",this.$viewValue):e.select2("val",this.$viewValue)):(d.addClass(e.select2("container"),"select2-container-not-empty"),l(function(a){o?e.select2("data",a):e.select2("val",a.id)})))},n.initSelection){var B=n.initSelection;n.initSelection=function(a,b){B(k.$viewValue,function(a){a&&(s[a.id]=a),b(a)})}}else n.initSelection=function(a,b){l(b)};var C={close:function(){e.select2("close")}};f.$register(C),a.$on("destroy",function(){f.$unregister(C)}),b(function(){A=!0,e.val(k.$viewValue),e.select2(n),e.on("change",function(b){a.$evalAsync(function(){var a;if(o){for(var c=[],d=0;d<b.val.length;d++)a=s[b.val[d]],a&&c.push(a.id);k.$setViewValue(c)}else a=s[b.val],k.$setViewValue(a?a.id:null);k.$render()})}),e.on("select2-blur",function(){k.$touched||a.$evalAsync(k.$setTouched)}),n.allowClear&&d.addClass(e.select2("container"),"select2-container-allow-clear"),p&&d.addClass(e.select2("dropdown"),"select2-searchbox-hidden")})}}}]);