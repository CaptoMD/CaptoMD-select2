angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var n=[];return{$register:function(e){n.push(e)},$unregister:function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)},closeAll:function(){n.forEach(function(e){e.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$animate","$q","select2Config","select2Stack",function(e,t,E,V,x,n,O){"use strict";function k(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort()}var q={},j=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return n&&angular.extend(q,n),{restrict:"E",require:["ngModel","select2"],template:'<input type="hidden">',bindToController:{s2Query:"<",s2InitSelection:"<"},controller:["$element",function(t){this.open=function(){t.select2("open")},this.close=function(){t.select2("close")};var n=[];this.onReady=function(e){n.push(e)},this.$postLink=function(){for(var e=0;e<n.length;++e)n[e].apply(this)},Object.defineProperty(this,"value",{get:function(){return t.select2("val")},set:function(e){t.select2("val",e)}})}],link:function(c,r,t,e){var l=e[0],n=e[1],i=angular.extend({},q,c.$eval(t.options)),a=angular.isDefined(t.multiple)||i.multiple,o=angular.isDefined(t.hideSearchbox)&&"false"!==t.hideSearchbox;if(Object.defineProperty(n,"options",{value:i}),Object.defineProperty(n,"isMultiple",{value:a}),Object.defineProperty(n,"hideSearchBox",{value:o}),i.multiple=a){var s=l.$isEmpty;l.$isEmpty=function(e){return s(e)||0===e.length}}if(t.emptyValue){var u=l.$isEmpty;l.$isEmpty=function(e){return u(e)||e===t.emptyValue}}if(angular.isDefined(t.allowClear)&&(i.allowClear="false"!==t.allowClear),angular.isUndefined(i.placeholder)){var f=t.placeholder||t.emptyValue;f?i.placeholder=f:i.allowClear&&(i.placeholder="-")}var d,h={};if(t.s2Options){var v;if(!(v=t.s2Options.match(j)))throw new Error("Invalid s2Options encountered!");var p=E(v[2]||v[1]),y=E(v[7]),m=v[4]||v[6],g=E(v[2]?v[1]:m),w=v[5];d=function(){h={};for(var e=y(c),t=(w?k(e):e)||[],n=[],r=0;r<t.length;r++){var i={},l=r;w&&(l=t[r],i[w]=l),i[m]=e[l];var a=g(c,i),o=p(c,i)||"";h[a]={id:a,text:o,obj:e[l]},n.push(h[a])}return x.when(n)},i.query=function(e){for(var t=y(c),n=(w?k(t):t)||[],r=[],i=0;i<n.length;i++){var l={},a=i;w&&(a=n[i],l[w]=a),l[m]=t[a];var o=g(c,l),s=p(c,l)||"";-1<s.toLowerCase().indexOf(e.term.toLowerCase())&&r.push({id:o,text:s,obj:t[a]})}e.callback({results:r})},c.$watchCollection(v[7],function(){d().then(function(){l.$render()})})}else{if(!i.query&&!t.s2Query)throw new Error("You need to supply a query function!");var b=i.query;i.query=function(e){var r=e.callback;e.callback=function(e){for(var t=0;t<e.results.length;t++){var n=e.results[t];h[n.id]=n}r(e),l.$validate()},(b||n.s2Query)(e)},d=function(){var t=x.defer();return i.query({term:"",callback:function(e){t.resolve(e.results)}}),t.promise}}function C(i){if(l.$isEmpty(i))return x.when(void 0);if(a){for(var e=[],t=0;t<i.length;t++){var n=h[i[t]];if(angular.isUndefined(n)){e=void 0;break}e.push(n)}return angular.isDefined(e)?x.when(e):d().then(function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];-1<(i||[]).indexOf(r.id)&&t.push(r)}return t})}var r=h[i];return r?x.when(r):d().then(function(e){for(var t=0;t<e.length;t++){var n=e[t];if(i===n.id)return n}})}if(i.initSelection||t.s2InitSelection){var S=i.initSelection;i.initSelection=function(e,t){if(l.$isEmpty(l.$modelValue))return t();(S||n.s2InitSelection)(l.$modelValue,function(e){!function e(t){if(angular.isArray(t))for(var n=0;n<t.length;n++)e(t[n]);else t&&(h[t.id]=t)}(e),t(e),l.$validate()})}}else i.initSelection=function(e,t){if(l.$isEmpty(l.$modelValue))return t();C(l.$modelValue).then(t).then(function(){l.$validate()})};O.$register(n),c.$on("$destroy",function(){r.select2("destroy"),O.$unregister(n)}),r.select2(i),r.on("change",function(e){l.$setViewValue(e.val)}),r.on("select2-blur",function(){l.$touched||l.$setTouched()}),r.on("select2-open",function(){c.$emit("select2:open")}),r.on("select2-close",function(){c.$emit("select2:close")}),l.$render=function(){a?C(l.$viewValue).then(function(e){r.select2("data",e)}):n.value!==this.$viewValue&&(n.value=this.$viewValue)},l.$validators.value=function(e){if(l.$isEmpty(e))return!0;if(a){for(var t=0;t<e.length;t++){var n=h[e[t]];if(!n||n.invalid)return!1}return!0}return h[e]&&!h[e].invalid},t.$observe("placeholder",function(e){var t=r.data("select2");if(t&&(t.opts.placeholder=e),a)t.clearSearch();else if(l.$isEmpty(l.modelValue)){var n=$(r.select2("container"));n.find(".select2-choice").addClass("select2-default"),n.find(".select2-chosen").html(e)}e?V.removeClass(r.select2("container"),"select2-placeholder-hidden"):V.addClass(r.select2("container"),"select2-placeholder-hidden")}),i.placeholder||V.addClass(r.select2("container"),"select2-placeholder-hidden"),o&&V.addClass(r.select2("dropdown"),"select2-searchbox-hidden")}}}]);