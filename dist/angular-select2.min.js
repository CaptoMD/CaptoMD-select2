angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var a=[];return{$register:function(b){a.push(b)},$unregister:function(b){var c=a.indexOf(b);c!==-1&&a.splice(c,1)},closeAll:function(){a.forEach(function(a){a.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$animate","select2Config","select2Stack",function(a,b,c,d,e,f){"use strict";function g(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}var h={},i=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return e&&angular.extend(h,e),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden">',replace:!0,link:function(a,e,j,k){function l(a){if(n){for(var b=[],c=0;c<k.$viewValue.length;c++){var d=t[k.$viewValue[c]];if(angular.isUndefined(d)){b=void 0;break}b.push(d)}if(angular.isDefined(b))return a(b);s(function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=k.$viewValue||[];f.indexOf(e.id)>-1&&c.push(e)}return a(c)})}else{var e=t[k.$viewValue];if(e)return a(e);s(function(b){for(var c=0;c<b.length;c++){var d=b[c];if(k.$viewValue===d.id)return a(d)}return a()})}}var m=angular.extend({},h,a.$eval(j.options)),n=angular.isDefined(j.multiple)||m.multiple,o=angular.isDefined(j.hideSearchbox)&&"false"!==j.hideSearchbox;if(m.multiple=n,n){var p=k.$isEmpty;k.$isEmpty=function(a){return p(a)||0===a.length}}if(j.emptyValue){var q=k.$isEmpty;k.$isEmpty=function(a){return q(a)||a===j.emptyValue}}var r=j.placeholder||j.emptyValue;r?m.placeholder=r:j.allowClear&&(m.placeholder="-"),j.allowClear&&(m.allowClear=j.allowClear);var s,t={};if(j.s2Options){var u;if(!(u=j.s2Options.match(i)))throw new Error("Invalid s2Options encountered!");var v=c(u[2]||u[1]),w=c(u[7]),x=u[4]||u[6],y=c(u[2]?u[1]:x),z=u[5];s=function(b){t={};for(var c=w(a),d=(z?g(c):c)||[],e=[],f=0;f<d.length;f++){var h={},i=f;z&&(i=d[f],h[z]=i),h[x]=c[i];var j=y(a,h),k=v(a,h)||"";t[j]={id:j,text:k,obj:c[i]},e.push(t[j])}b(e)},m.query=function(b){for(var c=w(a),d=(z?g(c):c)||[],e=[],f=0;f<d.length;f++){var h={},i=f;z&&(i=d[f],h[z]=i),h[x]=c[i];var j=y(a,h),k=v(a,h)||"";k.toLowerCase().indexOf(b.term.toLowerCase())>-1&&e.push({id:j,text:k,obj:c[i]})}b.callback({results:e})},a.$watchCollection(u[7],function(){k.$render()}),s(angular.noop)}else{if(!m.query)throw new Error("You need to supply a query function!");var A=m.query;m.query=function(a){var b=a.callback;a.callback=function(a){for(var c=0;c<a.results.length;c++){var d=a.results[c];t[d.id]=d}b(a)},A(a)},s=function(a){m.query({term:"",callback:function(b){a(b.results)}})}}if(m.initSelection){var B=m.initSelection;m.initSelection=function(a,b){return k.$isEmpty(k.$viewValue)?b():void B(k.$viewValue,function(a){a&&(t[a.id]=a),b(a)})}}else m.initSelection=function(a,b){l(b)};var C={close:function(){e.select2("close")}};f.$register(C),a.$on("destroy",function(){f.$unregister(C)}),b(function(){e.val(k.$viewValue),e.select2(m),e.on("change",function(a){k.$setViewValue(a.val)}),e.on("select2-blur",function(){k.$touched||k.$setTouched()}),k.$render=function(){n?l(function(a){e.select2("data",a)}):e.select2("val")!==this.$viewValue&&e.select2("val",this.$viewValue)},r||d.addClass(e.select2("container"),"select2-placeholder-hidden"),o&&d.addClass(e.select2("dropdown"),"select2-searchbox-hidden")})}}}]);