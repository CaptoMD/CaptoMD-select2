angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var a=[];return{$register:function(b){a.push(b)},$unregister:function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},closeAll:function(){a.forEach(function(a){a.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$filter","$animate","select2Config","select2Stack",function(a,b,c,d,e,f,g){"use strict";function h(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}var i=d("filter"),j={},k=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return f&&angular.extend(j,f),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden">',replace:!0,link:function(a,d,f,l){function m(b){if(u){var c=u(a);if(c)return i(b,c)}return b}function n(a){o(q?function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=l.$viewValue||[];f.indexOf(e.id)>-1&&c.push(e)}a(c)}:function(){a(v[l.$viewValue]||{obj:{}})})}var o,p=angular.extend({},j,a.$eval(f.options)),q=angular.isDefined(f.multiple)||p.multiple,r=angular.isDefined(f.hideSearchbox)&&"false"!==f.hideSearchbox;if(p.multiple=q,q&&(l.$isEmpty=function(a){return!a||0===a.length}),f.emptyValue){var s=l.$isEmpty;l.$isEmpty=function(a){return s(a)||a===f.emptyValue}}var t=f.placeholder||f.emptyValue;t&&(p.placeholder=t),f.allowClear&&(p.allowClear=f.allowClear);var u=c(f.optionsFilter),v={};if(f.s2Options){var w;if(!(w=f.s2Options.match(k)))throw new Error("Invalid s2Options encountered!");var x=c(w[2]||w[1]),y=c(w[7]),z=w[4]||w[6],A=c(w[2]?w[1]:z),B=w[5];o=function(b){v={};for(var c=m(y(a)),d=(B?h(c):c)||[],e=[],f=0;f<d.length;f++){var g={},i=f;B&&(i=d[f],g[B]=i),g[z]=c[i];var j=A(a,g),k=x(a,g)||"";v[j]={id:j,text:k,obj:c[i]},e.push(v[j])}b(e)},p.query=function(b){for(var c=m(y(a)),d=(B?h(c):c)||[],e=[],f=0;f<d.length;f++){var g={},i=f;B&&(i=d[f],g[B]=i),g[z]=c[i];var j=A(a,g),k=x(a,g)||"";k.toLowerCase().indexOf(b.term.toLowerCase())>-1&&e.push({id:j,text:k,obj:c[i]})}b.callback({results:e})},a.$watchCollection(w[7],function(){l.$render()})}else{if(!p.query)throw new Error("You need to supply a query function!");var C=p.query;p.query=function(a){var b=a.callback;a.callback=function(a){for(var c=0;c<a.results.length;c++){var d=a.results[c];v[d.id]=d}b(a)},C(a)},o=function(a){p.query({term:"",callback:function(b){a(b.results)}})}}if(l.$render=function(){n(function(a){q?d.select2("data",a):d.select2("val",a.id)}),l.$isEmpty(this.$viewValue)?e.removeClass(d.select2("container"),"select2-container-not-empty"):e.addClass(d.select2("container"),"select2-container-not-empty")},p.initSelection){var D=p.initSelection;p.initSelection=function(a,b){D(a,function(a){v[a.id]=a,b(a)})}}else p.initSelection=function(a,b){n(b)};var E={close:function(){d.select2("close")}};g.$register(E),a.$on("destroy",function(){g.$unregister(E)}),b(function(){d.select2(p),d.on("change",function(b){a.$apply(function(){var a;if(q){for(var c=[],d=0;d<b.val.length;d++)a=v[b.val[d]],a&&c.push(a.id);l.$setViewValue(c)}else a=v[b.val],l.$setViewValue(a?a.id:null);l.$render()})}),d.on("select2-blur",function(){l.$touched||a.$apply(l.$setTouched)}),p.allowClear&&e.addClass(d.select2("container"),"select2-container-allow-clear"),r&&e.addClass(d.select2("dropdown"),"select2-searchbox-hidden"),l.$render()})}}}]);