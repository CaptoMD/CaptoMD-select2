angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var a=[];return{$register:function(b){a.push(b)},$unregister:function(b){var c=a.indexOf(b);c!==-1&&a.splice(c,1)},closeAll:function(){a.forEach(function(a){a.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$animate","$q","select2Config","select2Stack",function(a,b,c,d,e,f,g){"use strict";function h(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}var i={},j=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return f&&angular.extend(i,f),{require:["ngModel","select2"],priority:1,restrict:"E",template:'<input type="hidden">',replace:!0,controller:["$element",function(a){function b(){return a.select2("val")}function c(b){a.select2("val",b)}this.open=function(){a.select2("open")},this.close=function(){a.select2("close")},Object.defineProperty(this,"value",{get:b,set:c})}],link:function(a,b,f,k){function l(a){if(n.$isEmpty(a))return e.when(void 0);if(q){for(var b=[],c=0;c<a.length;c++){var d=w[a[c]];if(angular.isUndefined(d)){b=void 0;break}b.push(d)}return angular.isDefined(b)?e.when(b):v().then(function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=a||[];f.indexOf(e.id)>-1&&c.push(e)}return c})}var f=w[a];return f?e.when(f):v().then(function(b){for(var c=0;c<b.length;c++){var d=b[c];if(a===d.id)return d}})}function m(a){if(angular.isArray(a))for(var b=0;b<a.length;b++)m(a[b]);else a&&(w[a.id]=a)}var n=k[0],o=k[1],p=angular.extend({},i,a.$eval(f.options)),q=angular.isDefined(f.multiple)||p.multiple,r=angular.isDefined(f.hideSearchbox)&&"false"!==f.hideSearchbox;if(Object.defineProperty(o,"options",{value:p}),Object.defineProperty(o,"isMultiple",{value:q}),Object.defineProperty(o,"hideSearchBox",{value:r}),p.multiple=q,q){var s=n.$isEmpty;n.$isEmpty=function(a){return s(a)||0===a.length}}if(f.emptyValue){var t=n.$isEmpty;n.$isEmpty=function(a){return t(a)||a===f.emptyValue}}if(angular.isDefined(f.allowClear)&&(p.allowClear="false"!==f.allowClear),angular.isUndefined(p.placeholder)){var u=f.placeholder||f.emptyValue;u?p.placeholder=u:p.allowClear&&(p.placeholder="-")}var v,w={};if(f.s2Options){var x;if(!(x=f.s2Options.match(j)))throw new Error("Invalid s2Options encountered!");var y=c(x[2]||x[1]),z=c(x[7]),A=x[4]||x[6],B=c(x[2]?x[1]:A),C=x[5];v=function(){w={};for(var b=z(a),c=(C?h(b):b)||[],d=[],f=0;f<c.length;f++){var g={},i=f;C&&(i=c[f],g[C]=i),g[A]=b[i];var j=B(a,g),k=y(a,g)||"";w[j]={id:j,text:k,obj:b[i]},d.push(w[j])}return e.when(d)},p.query=function(b){for(var c=z(a),d=(C?h(c):c)||[],e=[],f=0;f<d.length;f++){var g={},i=f;C&&(i=d[f],g[C]=i),g[A]=c[i];var j=B(a,g),k=y(a,g)||"";k.toLowerCase().indexOf(b.term.toLowerCase())>-1&&e.push({id:j,text:k,obj:c[i]})}b.callback({results:e})},a.$watchCollection(x[7],function(){n.$render()}),v()}else{if(!p.query)throw new Error("You need to supply a query function!");var D=p.query;p.query=function(a){var b=a.callback;a.callback=function(a){for(var c=0;c<a.results.length;c++){var d=a.results[c];w[d.id]=d}b(a)},D(a)},v=function(){var a=e.defer();return p.query({term:"",callback:function(b){a.resolve(b.results)}}),a.promise}}if(p.initSelection){var E=p.initSelection;p.initSelection=function(a,b){return n.$isEmpty(n.$modelValue)?b():void E(n.$modelValue,function(a){m(a),b(a),n.$validate()})}}else p.initSelection=function(a,b){return n.$isEmpty(n.$modelValue)?b():void l(n.$modelValue).then(b).then(function(){n.$validate()})};g.$register(o),a.$on("destroy",function(){g.$unregister(o)}),b.val(n.$viewValue),b.select2(p),b.on("change",function(a){n.$setViewValue(a.val)}),b.on("select2-blur",function(){n.$touched||n.$setTouched()}),b.on("select2-open",function(){a.$emit("select2:open")}),b.on("select2-close",function(){a.$emit("select2:close")}),n.$render=function(){q?l(n.$viewValue).then(function(a){b.select2("data",a)}):o.value!==this.$viewValue&&(o.value=this.$viewValue)},n.$validators.value=function(a){if(n.$isEmpty(a))return!0;if(q){for(var b=0;b<a.length;b++){var c=w[a[b]];if(!c||c.invalid)return!1}return!0}return w[a]&&!w[a].invalid},q||f.$observe("placeholder",function(a){if(n.$isEmpty(n.modelValue)){var c=$(b.select2("container"));c.find(".select2-choice").addClass("select2-default"),c.find(".select2-chosen").html(a)}}),p.placeholder||d.addClass(b.select2("container"),"select2-placeholder-hidden"),r&&d.addClass(b.select2("dropdown"),"select2-searchbox-hidden")}}}]);